<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Ways to define a pin mapping - Sduino</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Sduino</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">Overview</a>
</li>

                        
                            
<li >
    <a href="../install/">Installation</a>
</li>

                        
                            
<li >
    <a href="../sdcc/">Using the SDCC compiler</a>
</li>

                        
                            
<li >
    <a href="../spl/">Using the SPL with SDCC and sduino</a>
</li>

                        
                            
<li >
    <a href="../macro/">C preprocessor macro magic</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Libraries <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../api/">API description and migration guidelines</a>
</li>

                        
                            
<li >
    <a href="../api/HardwareSerial/">HardwareSerial</a>
</li>

                        
                            
<li >
    <a href="../api/SPI/">SPI</a>
</li>

                        
                            
<li >
    <a href="../api/I2C/">I2C</a>
</li>

                        
                            
<li >
    <a href="../api/LiquidCrystal/">LiquidCrystal character LCD library</a>
</li>

                        
                            
<li >
    <a href="../api/PCD8544/">PCD8544 libray for Nokia 5110-like graphical LCDs</a>
</li>

                        
                            
<li >
    <a href="../api/Mini_SSD1306/">Mini_SSD1306 library for monochrome OLED-displays</a>
</li>

                        
                            
<li >
    <a href="../api/Stepper/">Stepper library</a>
</li>

                        
                            
<li >
    <a href="../api/Servo/">Servo library</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Hardware <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../flashtool/">Flash tool</a>
</li>

                        
                            
<li >
    <a href="../hardware/">List of supported boards</a>
</li>

                        
                            
<li class="active">
    <a href="./">Ways to define a pin mapping</a>
</li>

                        
                            
<li >
    <a href="../hardware/stm8blue/">Generic STM8S103 breakout board (stm8blue)</a>
</li>

                        
                            
<li >
    <a href="../hardware/esp14/">ESP14: Wifi board, STM8S003</a>
</li>

                        
                            
<li >
    <a href="../hardware/stm8sdiscovery/">STM8S105Discovery: Evaluation board made my ST</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../about/">About</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../hardware/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../hardware/stm8blue/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#pin-mapping-scheme">Pin mapping scheme</a></li>
        
            <li><a href="#possible-logical-pin-number-mappings">Possible logical pin number mappings</a></li>
        
            <li><a href="#comparing-the-results">Comparing the results</a></li>
        
            <li><a href="#pin-remapping">Pin remapping</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="pin-mapping-scheme">Pin mapping scheme</h1>
<p>Many Arduino sketches and libraries contain hard-coded assumptions about the
number of pins with special functions. Ideally, all these numbers would be
the same and all programs could be compiled without changes. This is not
possible, but let's check how close we could get for the STM8S103F.</p>
<h2 id="possible-logical-pin-number-mappings">Possible logical pin number mappings</h2>
<p><strong>Functional mapping</strong> would try to match the pins with special functions
(like serial, SPI, I2C, analog input and PWM output) as closely as possible.</p>
<p><strong>Geometrical mapping</strong> would choose a logical order of the CPU pins as they
are accessible on the CPU or with a breakout board.</p>
<p>Functional mapping would allow for designing a PCB using the Arduino Uno
form factor and take advantage of all the existing shields (as long as they
are 3.3V compatible). The number of needed changes to existing sketches
would be cut down to a minimum. The downside would be a pretty random order
of pin numbers when using a simple breakout board.</p>
<p>Geometrical mapping is easier for breadboard use, but will always require
changes on existing sketches. Since we need to modify them from C++ to C
syntax anyway that is maybe a less severe problem than it sounds.</p>
<h3 id="a-matching-the-communication-pins">a) Matching the communication pins</h3>
<table>
<thead>
<tr>
<th>STM8 pin</th>
<th>Name</th>
<th>Alt</th>
<th>Arduino pin</th>
<th>ATmega pin</th>
<th>Alt</th>
</tr>
</thead>
<tbody>
<tr>
<td>PD6</td>
<td>RX</td>
<td>Ain6</td>
<td>0</td>
<td>PD0</td>
<td></td>
</tr>
<tr>
<td>PD5</td>
<td>TX</td>
<td>Ain5</td>
<td>1</td>
<td>PD1</td>
<td></td>
</tr>
<tr>
<td>PA3</td>
<td>SS</td>
<td></td>
<td>10</td>
<td>PB2</td>
<td>PWM</td>
</tr>
<tr>
<td>PC6</td>
<td>MOSI</td>
<td></td>
<td>11</td>
<td>PB3</td>
<td>PWM</td>
</tr>
<tr>
<td>PC7</td>
<td>MISO</td>
<td></td>
<td>12</td>
<td>PB4</td>
<td></td>
</tr>
<tr>
<td>PC5</td>
<td>SCK</td>
<td></td>
<td>13</td>
<td>PB5</td>
<td>LED</td>
</tr>
<tr>
<td>PB5</td>
<td>SDA</td>
<td>LED</td>
<td>18</td>
<td>PC4</td>
<td>Ain4</td>
</tr>
<tr>
<td>PB4</td>
<td>SCL</td>
<td></td>
<td>19</td>
<td>PC5</td>
<td>Ain5</td>
</tr>
</tbody>
</table>
<h3 id="b-matching-the-analog-inputs">b) Matching the analog inputs</h3>
<table>
<thead>
<tr>
<th>STM8 pin</th>
<th>Name</th>
<th>Alt</th>
<th>Arduino pin</th>
<th>ATmega pin</th>
<th>Alt</th>
</tr>
</thead>
<tbody>
<tr>
<td>C4</td>
<td>Ain2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>D2</td>
<td>Ain3</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>D3</td>
<td>Ain4</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>D5</td>
<td>Ain5</td>
<td>TX</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>D6</td>
<td>Ain6</td>
<td>RX</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="c-matching-the-pwm-capable-pins">c) Matching the PWM-capable pins</h3>
<table>
<thead>
<tr>
<th>STM8 pin</th>
<th>Name</th>
<th>Alt</th>
<th>Arduino pin</th>
<th>ATmega pin</th>
<th>Alt</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td>3</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>5</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>6</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>9</td>
<td></td>
<td></td>
</tr>
<tr>
<td>(</td>
<td></td>
<td></td>
<td>10</td>
<td>)</td>
<td></td>
</tr>
<tr>
<td>(</td>
<td></td>
<td></td>
<td>11</td>
<td>)</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="d-matching-the-led-collision">d) Matching the LED: (collision)</h3>
<table>
<thead>
<tr>
<th>STM8 pin</th>
<th>Name</th>
<th>Alt</th>
<th>Arduino pin</th>
<th>ATmega pin</th>
<th>Alt</th>
</tr>
</thead>
<tbody>
<tr>
<td>PB5</td>
<td>SDA</td>
<td></td>
<td>13</td>
<td>SCK</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="e-simple-geometric-numbering-for-so20-package-count-up-from-1-starting-at-pin-1">e) Simple geometric numbering for SO20 package (count up from 1, starting at pin 1)</h3>
<pre><code> 1-3  -&gt; PD4-PD6
 4-6  -&gt; PA1-PA3
 7-8  -&gt; PB5-PB4 (reverse order)
 9-13 -&gt; PC3-PC7
14-16 -&gt; PD1-PD3
</code></pre>
<p>SPI: 6,11,12,13 (same numbers as Arduino, but with different meanings -&gt;
error prone)<br />
I2C: 7,8<br />
serial: 2,3<br />
Analog: 2,3,10,15,16 (data sheet order would be: 10,15,16,2,3)  </p>
<ul>
<li>Easy and logical for use on a breadboard</li>
<li>Logical port pin ordering</li>
<li>Analog pins are scattered</li>
<li>All functions use totally different pin numbers than Arduino</li>
</ul>
<h3 id="f-simple-geometric-numbering-for-square-ufqfpn20-package-count-up-from-0-starting-at-pin-2pa1">f) Simple geometric numbering for square UFQFPN20 package (count up from 0, starting at pin 2/PA1)</h3>
<pre><code> 0-2  -&gt; PA1-PA3
 3-4  -&gt; PB5-PB4 (reverse order)
 5-9 -&gt; PC3-PC7
10-15 -&gt; PD1-PD6
</code></pre>
<p>serial: 14,15<br />
SPI: 2,7,8,9<br />
I2C: 3,4<br />
Analog: 6,11,12,14,15 (for an easier structure maybe use non-continous
numbers for the Arduino-like Ax-numbers: A0, A1, A2, A4, A5)<br />
PWM: 2,5,6,12 plus either only 13 or 7-9 but not 13 (via alternate mapping)<br />
PWM Bitmap pin 15-0: 0011 0000 0110 0100 = 0x3064 (regular mapping)<br />
PWM Bitmap pin 15-0: 0001 0011 1110 0100 = 0x13e4 (alternate mapping)  </p>
<ul>
<li>Easy and logical for use on a breadboard</li>
<li>Very clear and logical port pin ordering</li>
<li>Analog pins are still scattered around</li>
<li>TX and RX would be the rarely used analog pin numbers A3/A4 or A4/A5 at
   the end of the analog pin number list</li>
<li>At least the analog pins are in data sheet order</li>
<li>All functions use totally different pin numbers than Arduino</li>
</ul>
<h2 id="comparing-the-results">Comparing the results</h2>
<p>Compare logical/functional mapping vs. simple geometrical numbering</p>
<table>
<thead>
<tr>
<th>Phys. STM8 pin</th>
<th>Name</th>
<th>Functions</th>
<th>Functional mapping</th>
<th>Geometrical</th>
<th>mapping</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>strict</td>
<td>from PA1</td>
</tr>
<tr>
<td>1</td>
<td>PD4</td>
<td>UART_CLK/T2-1/beep</td>
<td>5</td>
<td>1~</td>
<td>13~</td>
</tr>
<tr>
<td>2</td>
<td>PD5</td>
<td>TX/Ain5</td>
<td></td>
<td>1</td>
<td>2  14/A3</td>
</tr>
<tr>
<td>3</td>
<td>PD6</td>
<td>RX/Ain6</td>
<td></td>
<td>0</td>
<td>3  15/A4</td>
</tr>
<tr>
<td>5</td>
<td>PA1</td>
<td>(OscIn, kein HS)</td>
<td>6</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td>6</td>
<td>PA2</td>
<td>(OscIn, kein HS)</td>
<td>7</td>
<td>5</td>
<td>1</td>
</tr>
<tr>
<td>10</td>
<td>PA3</td>
<td>SS/T2-3</td>
<td></td>
<td>10</td>
<td>6~ 2~</td>
</tr>
<tr>
<td>11</td>
<td>PB5</td>
<td>SDA    LED</td>
<td>18</td>
<td>7</td>
<td>3</td>
</tr>
<tr>
<td>12</td>
<td>PB4</td>
<td>SCL</td>
<td>19</td>
<td>8</td>
<td>4</td>
</tr>
<tr>
<td>13</td>
<td>PC3</td>
<td>T1-3/[T1-n1]</td>
<td>9</td>
<td>9~</td>
<td>5~(n~)</td>
</tr>
<tr>
<td>14</td>
<td>PC4</td>
<td>T1-4/Ain2/[T1-n2]</td>
<td>4</td>
<td>10~</td>
<td>6~(n~)/A0</td>
</tr>
<tr>
<td>15</td>
<td>PC5</td>
<td>SCK/[T2-1]</td>
<td>13</td>
<td>11~</td>
<td>7(~)</td>
</tr>
<tr>
<td>16</td>
<td>PC6</td>
<td>MOSI/[T1-1]</td>
<td>11</td>
<td>12~</td>
<td>8(~)</td>
</tr>
<tr>
<td>17</td>
<td>PC7</td>
<td>MISO/[T1-2]</td>
<td>12</td>
<td>13~</td>
<td>9(~)</td>
</tr>
<tr>
<td>18</td>
<td>PD1</td>
<td>(SWIM)</td>
<td>8</td>
<td>14</td>
<td>10</td>
</tr>
<tr>
<td>19</td>
<td>PD2</td>
<td>Ain3/[T2-3]</td>
<td>3</td>
<td>15(~)</td>
<td>11(~~)/A1</td>
</tr>
<tr>
<td>20</td>
<td>PD3</td>
<td>Ain4/T2-2</td>
<td>2</td>
<td>16~</td>
<td>12~/A2</td>
</tr>
</tbody>
</table>
<p>Functional pin mapping:</p>
<p>TX/RX,SPI,I2C match the Arduino numbers</p>
<p>Analog mapped to D0-D4 (instead of D14-D19),</p>
<p>PWM 2,3,4,5,9,10,11,12,13 (Arduino PWM: 3,5,6,9,10,11, all matched except
for pin 6)</p>
<p>non-existant: 14-17 -&gt; it might be better to map I2C to 14 and 15.</p>
<p>Strict geometrical pin mapping:</p>
<p>SPI: 6,11,12,13 (same numbers as Arduino, but with different meanings -&gt;
error prone)<br />
I2C: 7,8<br />
serial: 2,3<br />
analog: 2,3,10,15,16<br />
PWM regular: 2,12,13<br />
PWM alternate: 7,8,9<br />
PWM alternate negative: 5,6<br />
PWM alternate (duplicates): 11  </p>
<h2 id="pin-remapping">Pin remapping</h2>
<p>Some functions share the same CPU port pin. The Alternate function remapping
register (AFR) is used to choose the actual function. Most important choice
is for pin PC5-PC7: SPI (default) or PWM (alternate). Unfortunatly, this
influences PD4 as well (default PWM, alternate non-PWM).</p>
<p>The AFR is two EEPROM cells at 0x4803 (OPT2) and 0x4804 (NOPT2, inverted).
Programmable via SWIM (see UM0470) and in IAP-Mode (see PM0051).</p>
<table>
<thead>
<tr>
<th>Bit</th>
<th>Pin influenced</th>
<th>Function for 0</th>
<th>Function for 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>AFR7</td>
<td>PC3,PC4</td>
<td>default</td>
<td>TIM1_CH1N, TIM1_CH2N</td>
</tr>
<tr>
<td>AFR4</td>
<td>PB4,PB5</td>
<td>default</td>
<td>ADC_ETR, TIM1_BKIN</td>
</tr>
<tr>
<td>AFR3</td>
<td>PC3</td>
<td>default</td>
<td>TLI</td>
</tr>
<tr>
<td>AFR1</td>
<td>PA3,PD2</td>
<td>default</td>
<td>SPI_NSS, TIM2_CH3</td>
</tr>
<tr>
<td>AFR0</td>
<td>PC5-PC7</td>
<td>GPIO/SPI</td>
<td>TIM2_CH1, TIM1_CH1, TIM1_CH2</td>
</tr>
</tbody>
</table></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
